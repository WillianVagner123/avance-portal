generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "sqlite"
}

enum UserStatus {
  PENDING
  ACTIVE
  DENIED
}

enum UserRole {
  MASTER
  PROFESSIONAL
}

model User {
  id                String     @id @default(cuid())
  email             String     @unique
  name              String?
  status            UserStatus @default(PENDING)
  role              UserRole   @default(PROFESSIONAL)
  konsistMedicoNome String?

  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  accessRequests         AccessRequest[]
  googleCalendarLink     GoogleCalendarLink?
  konsistProfessionalMap KonsistProfessionalMap?
}

enum RequestStatus {
  PENDING
  APPROVED
  DENIED
}

model AccessRequest {
  id     String        @id @default(cuid())
  email  String
  name   String?
  status RequestStatus @default(PENDING)

  reviewedBy String?
  reviewedAt DateTime?

  userId String?
  user   User?   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
}

model AuditLog {
  id         String   @id @default(cuid())
  actorEmail String?
  action     String
  target     String?
  meta       String?
  createdAt  DateTime @default(now())
}

model GoogleCalendarLink {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  calendarId   String?
  calendarName String?

  approved   Boolean   @default(false)
  approvedBy String?
  approvedAt DateTime?

  accessToken  String?
  refreshToken String?
  expiryDate   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model KonsistProfessionalMap {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  konsistProfissionalNome String
  konsistProfissionalId   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
